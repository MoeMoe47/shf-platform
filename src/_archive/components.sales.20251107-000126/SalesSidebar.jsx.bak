// src/components/sales/SalesSidebar.jsx
import React from "react";
import { NavLink } from "react-router-dom";

const KEY = "sales:rail:collapsed";

const Item = ({ to, icon, children, end = false }) => (
  <li>
    <NavLink
      to={to}
      end={end}
      className={({ isActive }) => (isActive ? "crb-link is-active" : "crb-link")}
      title={typeof children === "string" ? children : undefined}
      aria-label={typeof children === "string" ? children : undefined}
    >
      <span className="crb-linkIcon" aria-hidden>{icon}</span>
      <span className="crb-linkLabel">{children}</span>
    </NavLink>
  </li>
);

const ItemExt = ({ href, icon, children }) => (
  <li>
    <a
      className="crb-link"
      href={href}
      title={typeof children === "string" ? children : undefined}
      aria-label={typeof children === "string" ? children : undefined}
    >
      <span className="crb-linkIcon" aria-hidden>{icon}</span>
      <span className="crb-linkLabel">{children}</span>
    </a>
  </li>
);

export default function SalesSidebar() {
  const [collapsed, setCollapsed] = React.useState(() => {
    try { return localStorage.getItem(KEY) === "1"; } catch { return false; }
  });

  React.useEffect(() => {
    try { localStorage.setItem(KEY, collapsed ? "1" : "0"); } catch {}
    const html = document.documentElement;
    if (collapsed) html.setAttribute("data-rail", "collapsed");
    else html.removeAttribute("data-rail");
  }, [collapsed]);

  return (
    <nav className="crb-nav" aria-label="Sales Navigation">
      {/* OVERVIEW */}
      <div className="crb-navSection">
        <div className="crb-navTitle">OVERVIEW</div>
        <ul className="crb-list">
          <Item to="/dashboard" icon="üìä" end>Dashboard</Item>
          <Item to="/pipeline"  icon="üìà">Pipeline</Item>
          <Item to="/analytics" icon="üìâ">Analytics</Item>
          <Item to="/exports"   icon="üìë">Exports</Item>
        </ul>
      </div>

      {/* REVENUE WORK */}
      <div className="crb-navSection">
        <div className="crb-navTitle">REVENUE</div>
        <ul className="crb-list">
          <Item to="/leads"         icon="üß≤">Leads</Item>
          <Item to="/opportunities" icon="üíº">Opportunities</Item>
          <Item to="/accounts"      icon="üë•">Accounts</Item>
          <Item to="/quotes"        icon="üßæ">Quotes</Item>
          <Item to="/orders"        icon="üõí">Orders</Item>
          <Item to="/invoices"      icon="üì¨">Invoices</Item>
          <Item to="/ledger"        icon="üìí">Ledger</Item>
        </ul>
      </div>

      {/* CATALOG & PRICING */}
      <div className="crb-navSection">
        <div className="crb-navTitle">CATALOG</div>
        <ul className="crb-list">
          <Item to="/bundles"  icon="üß∞">Bundles</Item>
          <Item to="/pricing"  icon="üè∑Ô∏è">Pricing</Item>
          <Item to="/proposal" icon="üìù">Proposals</Item>
        </ul>
      </div>

      {/* TOOLS */}
      <div className="crb-navSection">
        <div className="crb-navTitle">TOOLS</div>
        <ul className="crb-list">
          <Item to="/calculator" icon="üßÆ">Calculator</Item>
          <Item to="/roi"        icon="üìà">ROI</Item>
          <Item to="/verifier"   icon="‚úÖ">Verifier</Item>
          <Item to="/coach"      icon="ü§ñ">Coach</Item>
          <Item to="/demo"       icon="üé¨">Demo Hub</Item>
        </ul>
      </div>

      {/* CROSS APPS */}
      <div className="crb-navSection">
        <div className="crb-navTitle">CROSS APPS</div>
        <ul className="crb-list">
          <ItemExt href="/treasury.html#/dashboard" icon="üè¶">Treasury</ItemExt>
          <ItemExt href="/career.html#/dashboard"   icon="üß≠">Career</ItemExt>
          <ItemExt href="/employer.html#/dashboard" icon="üè¢">Employer</ItemExt>
          <ItemExt href="/credit.html#/report"      icon="üßæ">Credit</ItemExt>
          <ItemExt href="/debt.html#/dashboard"     icon="‚è±Ô∏è">Debt</ItemExt>
        </ul>
      </div>

      {/* APP */}
      <div className="crb-navSection">
        <div className="crb-navTitle">APP</div>
        <ul className="crb-list">
          <Item to="/settings" icon="‚öôÔ∏è">Settings</Item>
          <Item to="/help"     icon="‚ùì">Help</Item>
        </ul>
      </div>

      {/* Collapse control */}
      <div className="crb-railToggleWrap">
        <button
          type="button"
          className="crb-railToggle"
          onClick={() => setCollapsed((c) => !c)}
          aria-pressed={collapsed}
          aria-label={collapsed ? "Expand sidebar" : "Collapse sidebar"}
          title={collapsed ? "Expand sidebar" : "Collapse sidebar"}
        >
          <span className="lbl-emoji" aria-hidden>{collapsed ? "‚û°Ô∏è" : "‚¨ÖÔ∏è"}</span>
          <span className="lbl-text">{collapsed ? "Expand" : "Collapse"}</span>
        </button>
      </div>
    </nav>
  );
}
