// src/components/CurriculumSidebar.jsx
import React, { useMemo, useState } from "react";
import AppLink from "@/components/nav/AppLink.jsx";
import { NavLink } from "react-router-dom";
import { inApp, href, INSTRUCTOR, MASTER } from "@/router/paths.js";

const linkClass = ({ isActive }) => "cur-link" + (isActive ? " is-active" : "");

// Small collapsible section (keeps labels hidden when collapsed)
function Section({ title, emoji, children, defaultOpen = true }) {
  const [open, setOpen] = useState(defaultOpen);
  return (
    <section className={"cur-navSection" + (open ? " is-open" : "")}>
      <button
        className="cur-navTitle cur-navTitleBtn"
        aria-expanded={open}
        onClick={() => setOpen(v => !v)}
        title={title}
        type="button"
      >
        <span className="cur-emoji" aria-hidden>{emoji}</span>
        <span className="cur-label">{title}</span>
        <span className="cur-chevron" aria-hidden>{open ? "â–¾" : "â–¸"}</span>
      </button>
      {open && <ul className="cur-list">{children}</ul>}
    </section>
  );
}

/**
 * ChatGPT-like sidebar:
 * - When collapsed, only emojis show (labels hidden via CSS in curriculum-sidebar.css)
 * - Uses inApp.curriculum(cur) to generate paths that match CurriculumRoutes
 * - Cross-app links use plain anchors built with href.*
 */
export default function CurriculumSidebar({
  cur = "asl",
  collapsed = false,
  onNavigate = () => {},
  P, // optional precomputed builders from layout
}) {
  const paths = P || useMemo(() => inApp.curriculum(cur), [cur]);

  return (
    <nav className="cur-nav" aria-label="Curriculum">
      {/* Brand / wordmark */}
      <div className="cur-brand">
        <span className="cur-emoji cur-brandEmoji" aria-hidden>ğŸ“š</span>
        <span className="cur-label cur-wordmark">Curriculum</span>
      </div>

      {/* Overview (ALL real in-app routes) */}
      <Section title="Overview" emoji="ğŸ " defaultOpen>
        <li><AppLink end to={paths.dashboard()} className={linkClass} onClick={onNavigate} title="Dashboard">ğŸ“Š<span className="cur-label">Dashboard</span></AppLink></li>
        <li><AppLink to={paths.calendar()}   className={linkClass} onClick={onNavigate} title="Calendar">ğŸ—“ï¸<span className="cur-label">Calendar</span></AppLink></li>
        <li><AppLink to={paths.portfolio()}  className={linkClass} onClick={onNavigate} title="Portfolio">ğŸ§°<span className="cur-label">Portfolio</span></AppLink></li>
      </Section>

      {/* Learning (ALL real in-app routes) */}
      <Section title="Learning" emoji="ğŸ“">
        <li><AppLink to={paths.lessons()}     className={linkClass} onClick={onNavigate} title="Lessons">ğŸ“’<span className="cur-label">Lessons</span></AppLink></li>
        <li><AppLink to={paths.assignments()} className={linkClass} onClick={onNavigate} title="Assignments">âœ…<span className="cur-label">Assignments</span></AppLink></li>
        <li><AppLink to={paths.help()}        className={linkClass} onClick={onNavigate} title="Help">â“<span className="cur-label">Help</span></AppLink></li>
      </Section>

      {/* Instructor / Master tools (only if you have those routes; otherwise keep for later) */}
      <Section title="Instructor Tools" emoji="ğŸ› ï¸">
        <li><AppLink to={INSTRUCTOR(cur)} className={linkClass} onClick={onNavigate} title="Instructor">ğŸ‘©â€ğŸ«<span className="cur-label">Instructor</span></AppLink></li>
        <li><AppLink to={MASTER(cur)}     className={linkClass} onClick={onNavigate} title="Master View">ğŸ§­<span className="cur-label">Master View</span></AppLink></li>
      </Section>

      {/* Cross-app quick links â€” these are anchors into other apps */}
      <Section title="Cross-App" emoji="ğŸ§­">
        <li><a className="cur-link" href={href.career("/dashboard")} onClick={onNavigate} title="Career">ğŸ’¼<span className="cur-label">Career</span></a></li>
        <li><a className="cur-link" href={href.arcade("/dashboard")} onClick={onNavigate} title="Arcade">ğŸ¯<span className="cur-label">Arcade</span></a></li>
        <li><a className="cur-link" href={href.store("/")}           onClick={onNavigate} title="Store">ğŸ›ï¸<span className="cur-label">Store</span></a></li>
      </Section>
    </nav>
  );
}
